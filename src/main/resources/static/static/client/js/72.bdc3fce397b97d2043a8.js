webpackJsonp([72],{"41Rh":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),i=a.n(o),s=a("vLgD"),l=a("7biW"),r=a("RAp7"),n=a("X2Oc"),c=a("CKLt"),u=a("l6IN"),m={inject:["reload"],mixins:[r.a],name:"index",components:{"search-area":l.a},data:function(){return{allTotal:0,unclassified:0,thisPageName:"",groupLists:[],searchData:[{type:"telephone",show:!0,name:"手机号"},{type:"groupName",show:!0,name:"分组名称"}],defTag:"telephone,groupName",total:0,lists:[],pageSizes:[10,30,50,100],listQuery:{page:1,limit:10,offset:0,starttime:"",endtime:"",groupId:""},dialogGroup:!1,dialogGroupType:1,groupform:{id:"",groupName:"",remark:""},dialogCustom:!1,dialogCustomType:1,customform:{groupId:0,id:"",telephone:"",email:"",contactName:"",companyName:""},dialogMigrate:!1,migrateform:{id:"",oldId:"",groupId:""},fileName:"",json:"",msg:""}},created:function(){this.navData(),this.getListGroups(),this.getList()},methods:{importFile:function(){var t=this,e=document.getElementById("file"),a=e.files[0].name,o=u.Loading.service();t.$nextTick(function(){Object(c.a)(e.files[0]).then(function(i){t.fileName=a,e.value="",o.close(),t.fileHandle(i)}).catch(function(a){e.value="",t.fileName="",o.close(),t.R(a)})})},fileHandle:function(t){var e=t.length;if(e>4e4)this.R("数据不能大于40000条！");else if(t[0].hasOwnProperty("手机号码")){for(var a=[],o=0;o<e;o++){var i=t[o],s=Object(n.o)(i["手机号码"]);if(Object(n.l)(s)){var l={};l.telephone=s,l.email=i["邮箱"]||"",l.contactName=i["姓名"]||"",l.companyName=i["公司名称"]||"",a.push(l)}}var r=a.filter(function(t,e,a){return a.findIndex(function(e){return e.telephone===t.telephone})===e});this.msg="已添加 "+e+" 条数据，去重过滤后，有效数据 "+r.length+" 条",this.json=r}else this.R("上传文件内容格式不正确，请参考模板重新上传文件！")},submitMigrate:function(){var t=this,e=t.migrateform;Object(s.b)("telephoneBook/updatePhone",e).then(function(e){t.getListGroups(),t.getList(),t.dialogMigrate=!1}).catch(function(){})},migrate:function(t){this.migrateform.id=t.id,this.migrateform.oldId=t.groupId,this.migrateform.groupId=0,this.dialogMigrate=!0},submitCustom:function(){var t=this,e=t.customform;if(1===t.dialogCustomType||2===t.dialogCustomType){if(!Object(n.l)(e.telephone))return void t.R("手机号格式不正确！");var a=2===t.dialogCustomType?"telephoneBook/updatePhone":"telephoneBook/telephoneBookSave";Object(s.b)(a,e).then(function(e){t.getListGroups(),t.getList(),t.dialogCustom=!1}).catch(function(){})}if(3===t.dialogCustomType){if(t.json.length<1)return void t.R("有效数据为空，请检查文件！");var o=t.customform.groupId;Object(s.b)("telephoneBook/batchSavePhones",{info:i()(t.json),groupId:o}).then(function(e){t.getListGroups(),t.getList(1),t.msg="",t.dialogCustom=!1}).catch(function(){})}},submitGroup:function(){var t=this,e=t.groupform;if(e.groupName){var a=2===t.dialogGroupType?"telephoneBook/updateGroup":"telephoneBook/saveGroup";Object(s.b)(a,e).then(function(e){t.getListGroups(),t.dialogGroup=!1}).catch(function(){})}else t.R("分组名称不能为空！")},addGroup:function(){var t=this;t.groupform.id="",t.groupform.groupName="",t.groupform.remark="",t.dialogGroupType=1,t.dialogGroup=!0},editGroup:function(t){var e=this;e.groupform.id=t.id,e.groupform.groupName=t.groupName,e.groupform.remark=t.remark,e.dialogGroupType=2,e.dialogGroup=!0},delGroup:function(t){var e=this;e.$confirm("删除分组将删除该分组下全部客户，是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.b)("telephoneBook/removeGroup",{id:t}).then(function(t){e.getListGroups(),e.getList(1)}).catch(function(){})}).catch(function(){})},addCustom:function(t){var e=this;e.customform.groupId=e.listQuery.groupId||0,e.customform.telephone="",e.customform.email="",e.customform.companyName="",e.customform.contactName="",e.dialogCustomType=t?3:1,e.dialogCustom=!0},editCustom:function(t){var e=this;e.customform.groupId=t.groupId,e.customform.id=t.id,e.customform.telephone=t.telephone,e.customform.email=t.email,e.customform.contactName=t.contactName,e.customform.companyName=t.companyName,e.dialogCustomType=2,e.dialogCustom=!0},delCustom:function(t){var e=this,a={},o="telephoneBook/removePhone";if(t)a.id=t;else{o="telephoneBook/batchRemovePhones";var i=e.multipleSelection.map(function(t){return t.id});if(i.length<1)return void e.R("请选择要删除的数据!");a.ids=i}e.$confirm("您确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.b)(o,a).then(function(t){e.getListGroups(),e.getList()}).catch(function(){})}).catch(function(){})},groupId:function(t){this.listQuery.groupId=t,this.getList(1)},getList:function(t){var e=this;t&&(e.listQuery.page=1,e.listQuery.offset=0),e.listQuery.offset=(e.listQuery.page-1)*e.listQuery.limit,Object(s.a)("telephoneBook/listPhones",e.listQuery).then(function(t){e.lists=t.rows,e.total=t.total,""===e.listQuery.groupId&&(e.allTotal=t.total),0===e.listQuery.groupId&&(e.unclassified=t.total)}).catch(function(){})},getListGroups:function(){var t=this;Object(s.a)("telephoneBook/listGroups").then(function(e){t.groupLists=e.rows}).catch(function(){})},navData:function(){var t=this;Object(n.i)().then(function(e){var a=t.$route.path;t.$route.matched.length>0&&(a=t.$route.matched[0].path);var o=e.filter(function(t){return a===t.attributes.url})[0];t.thisPageName=o.text}).catch(function(){})}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contacts"},[a("div",{staticClass:"page-header"},[a("div",[a("router-link",{attrs:{to:"/"}},[t._v("首页")]),t._v(" "),a("i",{staticClass:"iconfont iconsystem-moreb"}),t._v(" "),a("span",[t._v(t._s(t.thisPageName))])],1),t._v(" "),a("p",[t._v(t._s(t.thisPageName))])]),t._v(" "),a("div",{staticClass:"wrapper"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"left"},[a("el-card",{staticClass:"group-default"},[a("div",{staticClass:"c",attrs:{slot:"header"},slot:"header"},[a("span",[a("b",[t._v("默认分组")])])]),t._v(" "),a("ul",[a("li",{attrs:{tabindex:"0"},on:{click:function(e){return t.groupId("")}}},[a("img",{attrs:{src:"/static/client/img/contacts/1.png"}}),t._v(" "),a("span",[t._v("全部客户 "),t.allTotal>0?a("font",[t._v("("+t._s(t.allTotal)+")")]):t._e()],1)]),t._v(" "),a("li",{attrs:{tabindex:"0"},on:{click:function(e){return t.groupId(0)}}},[a("img",{attrs:{src:"/static/client/img/contacts/2.png"}}),t._v(" "),a("span",[t._v("未分组客户 "),t.unclassified>0?a("font",[t._v("("+t._s(t.unclassified)+")")]):t._e()],1)])])]),t._v(" "),a("el-card",{staticClass:"group-custom mt2"},[a("div",{staticClass:"c",attrs:{slot:"header"},slot:"header"},[a("span",[a("b",[t._v("自定义分组")])]),t._v(" "),a("a",{staticClass:"fr cp add",on:{click:function(e){return t.addGroup()}}},[a("i",{staticClass:"el-icon-plus"})])]),t._v(" "),a("ul",t._l(t.groupLists,function(e){return a("li",{key:e.id,attrs:{tabindex:"0",title:e.groupName+" 备注："+e.remark},on:{click:function(a){return t.groupId(e.id)}}},[a("img",{attrs:{src:"/static/client/img/contacts/3.png"}}),t._v(" "),a("span",[t._v(t._s(e.groupName)+" ("+t._s(e.phoneNums)+")")]),t._v(" "),a("span",{staticClass:"fr"},[a("el-dropdown",{attrs:{size:"small"}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-more"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){return t.editGroup(e)}}},[t._v("编辑")]),t._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){return t.delGroup(e.id)}}},[t._v("删除")])],1)],1)],1)])}),0)])],1),t._v(" "),a("el-col",{staticClass:"right"},[a("el-card",{staticClass:"group-details"},[a("div",{staticClass:"c",attrs:{slot:"header"},slot:"header"},[a("span",[a("b",[t._v("客户信息")])])]),t._v(" "),a("div",[a("div",{staticClass:"query"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.addCustom()}}},[t._v("新增")]),t._v(" "),a("el-dropdown",{attrs:{size:"small"}},[a("el-button-group",[a("el-button",{attrs:{type:"default",size:"small"}},[t._v("批量操作")]),t._v(" "),a("el-button",{staticStyle:{height:"30px"},attrs:{type:"default",size:"small",icon:"el-icon-more"}})],1),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(e){return t.addCustom(1)}}},[t._v("文件导入")]),t._v(" "),a("el-dropdown-item",{nativeOn:{click:function(e){return t.delCustom()}}},[t._v("删除")])],1)],1),t._v(" "),a("el-date-picker",{attrs:{"popper-class":"veesing-date-picker",editable:!1,clearable:!1,size:"small",type:"datetimerange",format:"yyyy/MM/dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions},on:{change:function(e){return t.createTime()}},model:{value:t.datePickerVal,callback:function(e){t.datePickerVal=e},expression:"datePickerVal"}}),t._v(" "),a("search-area",{attrs:{search:t.searchData,defTag:t.defTag},on:{searchFun:t.searchFun}})],1),t._v(" "),a("el-table",{attrs:{data:t.lists},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"手机号码",prop:"telephone","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"姓名","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.contactName?a("p",{staticClass:"ellipsis",attrs:{title:e.row.contactName}},[t._v(t._s(e.row.contactName))]):a("p",[t._v("—")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"邮箱","min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.email?a("p",{staticClass:"ellipsis",attrs:{title:e.row.email}},[t._v(t._s(e.row.email))]):a("p",[t._v("—")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"公司名称","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.companyName?a("p",{staticClass:"ellipsis",attrs:{title:e.row.companyName}},[t._v(t._s(e.row.companyName))]):a("p",[t._v("—")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"所属群组","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.groupName))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",{staticClass:"operating"},[a("a",{on:{click:function(a){return t.editCustom(e.row)}}},[t._v("修改")]),t._v(" "),a("a",{on:{click:function(a){return t.delCustom(e.row.id)}}},[t._v("删除")])])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-size":t.listQuery.limit,"page-sizes":t.pageSizes,total:t.total,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)])],1)],1)],1),t._v(" "),a("transition",{attrs:{name:"dialog-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogGroup,expression:"dialogGroup"}],staticClass:"dialog dialog-min"},[a("div",{staticClass:"dialog-body"},[a("div",{staticClass:"dialog-header"},[1==t.dialogGroupType?a("span",[t._v("新增分组")]):t._e(),t._v(" "),2==t.dialogGroupType?a("span",[t._v("编辑分组")]):t._e(),t._v(" "),a("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogGroup=!1}}})]),t._v(" "),a("div",{staticClass:"dialog-content p2"},[a("el-form",{staticStyle:{width:"450px",margin:"0 auto"},attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"分组名称："}},[a("el-input",{attrs:{size:"small",placeholder:"请输入分组名称"},model:{value:t.groupform.groupName,callback:function(e){t.$set(t.groupform,"groupName","string"==typeof e?e.trim():e)},expression:"groupform.groupName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注："}},[a("el-input",{attrs:{type:"textarea",rows:4,resize:"none",size:"small",placeholder:"请输入备注"},model:{value:t.groupform.remark,callback:function(e){t.$set(t.groupform,"remark","string"==typeof e?e.trim():e)},expression:"groupform.remark"}})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer c p2"},[a("div",{staticClass:"fr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitGroup()}}},[t._v("确 认")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogGroup=!1}}},[t._v("取 消")])],1)])])])]),t._v(" "),a("transition",{attrs:{name:"dialog-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogCustom,expression:"dialogCustom"}],staticClass:"dialog dialog-min"},[a("div",{staticClass:"dialog-body"},[a("div",{staticClass:"dialog-header"},[1==t.dialogCustomType?a("span",[t._v("新增客户")]):t._e(),t._v(" "),2==t.dialogCustomType?a("span",[t._v("编辑客户")]):t._e(),t._v(" "),3==t.dialogCustomType?a("span",[t._v("批量新增客户")]):t._e(),t._v(" "),a("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogCustom=!1}}})]),t._v(" "),a("div",{staticClass:"dialog-content p2"},[3==t.dialogCustomType?a("div",{staticClass:"alert",staticStyle:{"margin-bottom":"20px"}},[a("i",{staticClass:"el-icon-warning color"}),t._v(" "),a("p",[a("b",[t._v("帮助提示")]),a("br"),t._v("\n              1.请按照模板格式填充数据后，再选择文件上传。"),a("a",{staticClass:"cp color",attrs:{href:"/static/client/tpl/contacts.xlsx",download:"通讯录模板文件.xlsx"}},[t._v("模板下载")]),t._v(" "),a("br"),t._v("\n              2.支持扩展名：.xls .xlsx "),a("br"),t._v("\n              3.单次最多允许上传40000条数据 "),a("br")])]):t._e(),t._v(" "),a("el-form",{staticStyle:{width:"450px",margin:"0 auto"},attrs:{"label-width":"100px"}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"分组："}},[a("el-select",{staticClass:"w100",attrs:{size:"small",placeholder:"请选择分组"},model:{value:t.customform.groupId,callback:function(e){t.$set(t.customform,"groupId",e)},expression:"customform.groupId"}},[a("el-option",{attrs:{label:"未分组",value:0}}),t._v(" "),t._l(t.groupLists,function(t){return a("el-option",{key:t.id,attrs:{label:t.groupName,value:t.id}})})],2)],1),t._v(" "),3==t.dialogCustomType?[a("div",{staticClass:"c"},[a("p",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("选择文件：")]),t._v(" "),a("label",{staticClass:"cp p2",staticStyle:{display:"block",background:"#FAFAFA","margin-left":"100px"}},[a("input",{staticClass:"hide",attrs:{type:"file",id:"file",accept:".xls,.xlsx"},on:{change:function(e){return t.importFile(this)}}}),t._v(" "),t.fileName?a("div",[t._v("\n                    "+t._s(t.fileName)+" "),a("span",{staticClass:"color"},[t._v("重新上传")])]):a("div",{staticClass:"t-c"},[a("img",{attrs:{src:"/static/client/img/sms/6.png",alt:"点击上传文件"}}),t._v(" "),a("p",{staticStyle:{"font-size":"16px",margin:"4px 0"}},[t._v("点击上传文件")]),t._v(" "),a("p",{staticClass:"info"},[t._v("支持扩展名：.xls .xlsx")])])]),t._v(" "),t.msg?a("p",{staticClass:"info t-r",staticStyle:{"margin-top":"10px","font-size":"12px"}},[t._v(t._s(t.msg))]):t._e()])]:[a("el-form-item",{staticClass:"is-required",attrs:{label:"手机号码："}},[a("el-input",{attrs:{size:"small",maxlength:"11",placeholder:"请输入手机号码"},model:{value:t.customform.telephone,callback:function(e){t.$set(t.customform,"telephone","string"==typeof e?e.trim():e)},expression:"customform.telephone"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"姓名："}},[a("el-input",{attrs:{size:"small",placeholder:"请输入姓名"},model:{value:t.customform.contactName,callback:function(e){t.$set(t.customform,"contactName","string"==typeof e?e.trim():e)},expression:"customform.contactName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"邮箱："}},[a("el-input",{attrs:{size:"small",placeholder:"请输入邮箱"},model:{value:t.customform.email,callback:function(e){t.$set(t.customform,"email","string"==typeof e?e.trim():e)},expression:"customform.email"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"公司名称："}},[a("el-input",{attrs:{size:"small",placeholder:"请输入公司名称"},model:{value:t.customform.companyName,callback:function(e){t.$set(t.customform,"companyName","string"==typeof e?e.trim():e)},expression:"customform.companyName"}})],1)]],2)],1),t._v(" "),a("div",{staticClass:"dialog-footer c p2"},[a("div",{staticClass:"fr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitCustom()}}},[t._v("确 认")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogCustom=!1}}},[t._v("取 消")])],1)])])])]),t._v(" "),a("transition",{attrs:{name:"dialog-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogMigrate,expression:"dialogMigrate"}],staticClass:"dialog dialog-min"},[a("div",{staticClass:"dialog-body"},[a("div",{staticClass:"dialog-header"},[a("span",[t._v("转移客户")]),t._v(" "),a("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogMigrate=!1}}})]),t._v(" "),a("div",{staticClass:"dialog-content p2"},[a("el-form",{staticStyle:{width:"450px",margin:"0 auto"},attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"原分组："}},[a("el-select",{staticClass:"w100",attrs:{size:"small",placeholder:"请选择分组",disabled:""},model:{value:t.migrateform.oldId,callback:function(e){t.$set(t.migrateform,"oldId",e)},expression:"migrateform.oldId"}},[a("el-option",{attrs:{label:"未分组",value:0}}),t._v(" "),t._l(t.groupLists,function(t){return a("el-option",{key:t.id,attrs:{label:t.groupName,value:t.id}})})],2)],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"新分组："}},[a("el-select",{staticClass:"w100",attrs:{size:"small",placeholder:"请选择分组"},model:{value:t.migrateform.groupId,callback:function(e){t.$set(t.migrateform,"groupId",e)},expression:"migrateform.groupId"}},[a("el-option",{attrs:{label:"未分组",value:0}}),t._v(" "),t._l(t.groupLists,function(t){return a("el-option",{key:t.id,attrs:{label:t.groupName,value:t.id}})})],2)],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer c p2"},[a("div",{staticClass:"fr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitMigrate()}}},[t._v("确 认")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogMigrate=!1}}},[t._v("取 消")])],1)])])])])],1)},staticRenderFns:[]},d=a("VU/8")(m,p,!1,null,null,null);e.default=d.exports}});