webpackJsonp([52],{ZgqZ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("vLgD"),s=a("7biW"),i={inject:["reload"],mixins:[a("RAp7").a],name:"tpl",components:{"search-area":s.a},data:function(){return{searchShow:!1,searchData:[{type:"id",show:!0,name:"模板ID"},{type:"tplName",show:!0,name:"模版名称"},{type:"tplType",name:"模版类型",show:!0,value:""},{type:"tplStatus",name:"状态",show:!0,value:[{name:"未审核",value:2},{name:"已通过",value:1},{name:"未通过",value:0}]}],defTag:"id,tplContent",typeLists:"",total:0,lists:[],pageSizes:[10,30,50,100],listQuery:{page:1,limit:10,offset:0,starttime:"",endtime:"",pdType:6},dialogTpl:!1,dialogTplType:1,form:{id:"",tplContent:"",tplType:""},smsContent:{signature:"",content:""},dialogDetail:!1,item:"",smsTplLength:0}},created:function(){var t=this;Object(n.a)("trigmsg/template/listTypes").then(function(e){t.typeLists=e;for(var a=[],n=0;n<e.length;n++){var s={};s.name=e[n].name,s.value=e[n].id,a.push(s)}t.searchData[2].value=a,t.$nextTick(function(){t.searchShow=!0})}).catch(function(t){console.log(t)}),t.getList()},methods:{d:function(t){this.item=t,this.dialogDetail=!0},submitTpl:function(){var t=this,e=t.smsContent;if(e.signature)if(e.content){t.form.tplContent="【"+e.signature+"】"+e.content;var a=2===t.dialogTplType?"globalSmsCode/template/update":"globalSmsCode/template/save";Object(n.b)(a,t.form).then(function(e){t.reload()}).catch(function(){})}else t.R("短信内容不能为空！");else t.R("签名不能为空！")},del:function(t){var e=this,a={};if(t)a.ids=[t];else{var s=e.multipleSelection.map(function(t){return t.id});if(s.length<1)return void e.R("请选择要删除的数据!");a.ids=s}e.$confirm("您确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(n.b)("globalSmsCode/template/batchRemove",a).then(function(t){e.getList()}).catch(function(){})}).catch(function(){})},addTpl:function(t){var e=this;t?(e.form.id=t.id,e.form.tplType=t.tplType,e.smsContent.content=t.tplContent,e.dialogTplType=2):(e.form.id="",e.form.tplType="",e.smsContent.signature="",e.smsContent.content="",e.form.tplContent="",e.dialogTplType=1),e.dialogTpl=!0},addVar:function(){this.smsContent.content=this.smsContent.content+"【变量】"},getList:function(t){var e=this;t&&(e.listQuery.page=1,e.listQuery.offset=0),e.listQuery.offset=(e.listQuery.page-1)*e.listQuery.limit,Object(n.a)("globalSmsCode/template/list",e.listQuery).then(function(t){e.lists=t.rows,e.total=t.total}).catch(function(){})},inputWitdh:function(){var t=$(".sms-content p").width();$(".sms-content input").width(t+2);var e=t+40;e=e>68?e:68,$(".sms-content textarea").css({"text-indent":e})},tplLenght:function(){var t=this.smsContent,e="【"+t.signature+"】"+t.content;return this.smsTplLength=e.length,e.length}},watch:{"smsContent.signature":function(t,e){var a=this;a.$nextTick(function(){a.inputWitdh(),a.tplLenght()>200&&(a.smsContent.signature=e)})},"smsContent.content":function(t,e){var a=this;a.$nextTick(function(){a.inputWitdh(),a.tplLenght()>200&&(a.smsContent.content=e)})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sms-tpl bgw"},[a("div",[a("div",{staticClass:"query p2"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.addTpl()}}},[t._v("新增模板")]),t._v(" "),a("el-dropdown",{attrs:{size:"small"}},[a("el-button-group",[a("el-button",{attrs:{type:"default",size:"small"}},[t._v("批量操作")]),t._v(" "),a("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-more"}})],1),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(e){return t.del()}}},[t._v("删除")])],1)],1),t._v(" "),a("el-date-picker",{attrs:{"popper-class":"veesing-date-picker",editable:!1,clearable:!1,size:"small",type:"datetimerange",format:"yyyy/MM/dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions},on:{change:function(e){return t.createTime()}},model:{value:t.datePickerVal,callback:function(e){t.datePickerVal=e},expression:"datePickerVal"}}),t._v(" "),t.searchShow?a("search-area",{attrs:{search:t.searchData,defTag:t.defTag},on:{searchFun:t.searchFun}}):t._e()],1),t._v(" "),a("div",{staticClass:"p2 pt0"},[a("el-table",{attrs:{data:t.lists},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{label:"模板ID",prop:"id",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"模板内容",prop:"tplContent","min-width":"200px","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"模版类型",prop:"tplTypeName"}}),t._v(" "),a("el-table-column",{attrs:{label:"更新时间","min-width":"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.modifyTime?a("span",[t._v(t._s(e.row.modifyTime))]):a("span",[t._v(t._s(e.row.createTime))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.tplStatus?a("p",{staticClass:"td-btn"},[a("font",{staticClass:"point point-error"},[t._v("未通过")])],1):t._e(),t._v(" "),2==e.row.tplStatus?a("p",{staticClass:"td-btn"},[a("font",{staticClass:"point point-warning"},[t._v("未审核")])],1):t._e(),t._v(" "),1==e.row.tplStatus?a("p",{staticClass:"td-btn"},[a("font",{staticClass:"point point-success"},[t._v("已通过")])],1):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",{staticClass:"operating"},[a("a",{on:{click:function(a){return t.d(e.row)}}},[t._v("详情")]),t._v(" "),a("a",{on:{click:function(a){return t.addTpl(e.row)}}},[t._v("修改")]),t._v(" "),a("a",{on:{click:function(a){return t.del(e.row.id)}}},[t._v("删除")])])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-size":t.listQuery.limit,"page-sizes":t.pageSizes,total:t.total,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)]),t._v(" "),a("transition",{attrs:{name:"dialog-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogTpl,expression:"dialogTpl"}],staticClass:"dialog dialog-min"},[a("div",{staticClass:"dialog-body"},[a("div",{staticClass:"dialog-header"},[1==t.dialogTplType?a("span",[t._v("新增模板")]):t._e(),t._v(" "),2==t.dialogTplType?a("span",[t._v("编辑模板")]):t._e(),t._v(" "),a("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogTpl=!1}}})]),t._v(" "),a("div",{staticClass:"dialog-content p2"},[a("div",{staticClass:"alert",staticStyle:{"margin-bottom":"20px"}},[a("i",{staticClass:"el-icon-warning color"}),t._v(" "),a("p",[a("b",[t._v("帮助提示")]),a("br"),t._v("\n              短信模板由签名和内容组成，签名通常为企业名称简称或品牌名称；"),a("br"),t._v("\n              短信内容需要包含变量，但内容主体部分需能够体现短信意图；"),a("br"),t._v("\n              短信一条为70个字符，超过70字符为长短信，长短信计费为每条67个字符。\n            ")])]),t._v(" "),a("el-form",{staticStyle:{width:"520px",margin:"0 auto"},attrs:{"label-position":"right","label-width":"100px"}},[t.form.id?a("div",{staticClass:"el-form-item"},[a("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板ID：")]),t._v(" "),a("div",{staticClass:"el-form-item__content info",staticStyle:{"margin-left":"100px"}},[t._v(t._s(t.form.id))])]):t._e(),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"模版类型:"}},[a("el-select",{staticClass:"w100",attrs:{placeholder:"请选择模版类型"},model:{value:t.form.tplType,callback:function(e){t.$set(t.form,"tplType",e)},expression:"form.tplType"}},t._l(t.typeLists,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("div",{staticClass:"el-form-item is-required"},[a("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板内容：")]),t._v(" "),a("div",{staticClass:"el-form-item__content",staticStyle:{"margin-left":"100px"}},[a("div",{staticClass:"sms-content p1",staticStyle:{"margin-top":"12px"}},[a("p",[t._v(t._s(t.smsContent.signature||"短信签名，如：中国移动"))]),t._v(" "),a("div",{staticClass:"input"},[a("span",[t._v("【")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.signature,expression:"smsContent.signature",modifiers:{trim:!0}}],attrs:{type:"text",maxlength:"24",placeholder:"短信签名，如：中国移动"},domProps:{value:t.smsContent.signature},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"signature",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),a("span",[t._v("】")])]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.content,expression:"smsContent.content",modifiers:{trim:!0}}],attrs:{rows:"8",placeholder:"短信内容，如：尊敬的张三你好，您本月消费金额为:【变量】元，请注意查收账单！"},domProps:{value:t.smsContent.content},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"content",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"t-r",staticStyle:{"margin-top":"10px"}},[a("span",{staticClass:"cp color",on:{click:function(e){return t.addVar()}}},[a("img",{staticStyle:{"vertical-align":"middle","margin-top":"-3px"},attrs:{src:"/static/client/img/sms/7.png"}}),t._v(" 添加变量")])])]),t._v(" "),a("div",{staticClass:"t-r info"},[t._v("\n                  "+t._s(t.smsTplLength)+"/200 字\n                ")])])])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer c p2"},[a("div",{staticClass:"fr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitTpl()}}},[t._v("确 认")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogTpl=!1}}},[t._v("取 消")])],1)])])])]),t._v(" "),a("transition",{attrs:{name:"dialog-fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogDetail,expression:"dialogDetail"}],staticClass:"dialog list-detail"},[a("div",{staticClass:"dialog-body"},[a("div",{staticClass:"dialog-header"},[t._v("\n          详情 "),a("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogDetail=!1}}})]),t._v(" "),a("div",{staticClass:"dialog-content c p2"},[a("div",{staticClass:"c"},[a("div",[a("span",[t._v("模板ID：")]),t._v(" "),a("span",[t._v(t._s(t.item.id))])]),t._v(" "),a("div",[a("span",[t._v("模板内容：")]),t._v(" "),a("span",[t._v(t._s(t.item.tplContent))])]),t._v(" "),a("div",[a("span",[t._v("模板类型：")]),t._v(" "),a("span",[t._v(t._s(t.item.tplTypeName))])])]),t._v(" "),a("div",{staticClass:"c"},[a("div",[a("span",[t._v("状态：")]),t._v(" "),0==t.item.tplStatus?a("span",{staticClass:"error"},[t._v("未通过")]):t._e(),t._v(" "),1==t.item.tplStatus?a("span",{staticClass:"success"},[t._v("已通过")]):t._e(),t._v(" "),2==t.item.tplStatus?a("span",{staticClass:"warning"},[t._v("未审核")]):t._e()]),t._v(" "),a("div",[a("span",[t._v("更新时间：")]),t._v(" "),t.item.modifyTime?a("span",[t._v(t._s(t.item.modifyTime))]):a("span",[t._v(t._s(t.item.createTime))])])])])])])])],1)},staticRenderFns:[]},o=a("VU/8")(i,l,!1,null,null,null);e.default=o.exports}});