webpackJsonp([35],{gIHK:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("vLgD"),a=n("7biW"),s={inject:["reload"],mixins:[n("RAp7").a],name:"tpl",components:{"search-area":a.a},data:function(){return{searchData:[{type:"id",show:!0,name:"模版ID"},{type:"tplContent",show:!0,name:"模版内容"}],defTag:"id,tplContent",total:0,lists:[],pageSizes:[10,30,50,100],listQuery:{page:1,limit:10,offset:0,starttime:"",endtime:"",pdType:3},dialogTpl:!1,dialogTplType:1,form:{id:"",tplContent:""},smsContent:{signature:"",content:""},dialogDetail:!1,item:"",smsTplLength:0}},created:function(){this.getList()},methods:{sent:function(t){this.$router.push({name:"SmsGroup",params:t})},d:function(t){this.item=t,this.dialogDetail=!0},submitTpl:function(){var t=this,e=t.smsContent;if(e.signature)if(e.content){t.form.tplContent="【"+e.signature+"】"+e.content;var n=2===t.dialogTplType?"sms/template/update":"sms/template/save";Object(i.b)(n,t.form).then(function(e){t.reload()}).catch(function(){})}else t.R("短信内容不能为空！");else t.R("签名不能为空！")},del:function(t){var e=this,n={};if(t)n.ids=[t];else{var a=e.multipleSelection.map(function(t){return t.id});if(a.length<1)return void e.R("请选择要删除的数据!");n.ids=a}e.$confirm("您确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(i.b)("sms/template/batchRemove",n).then(function(t){e.getList()}).catch(function(){})}).catch(function(){})},addTpl:function(t){var e=this;t?(e.form.id=t.id,e.smsContent.content=t.tplContent,e.dialogTplType=2):(e.form.id="",e.smsContent.signature="",e.smsContent.content="",e.form.tplContent="",e.dialogTplType=1),e.dialogTpl=!0},addVar:function(){this.smsContent.content=this.smsContent.content+"${变量}"},getList:function(t){var e=this;t&&(e.listQuery.page=1,e.listQuery.offset=0),e.listQuery.offset=(e.listQuery.page-1)*e.listQuery.limit,Object(i.a)("sms/template/list",e.listQuery).then(function(t){e.lists=t.rows,e.total=t.total}).catch(function(){})},inputWitdh:function(){var t=$(".sms-content p").width();$(".sms-content input").width(t+2);var e=t+40;e=e>68?e:68,$(".sms-content textarea").css({"text-indent":e})},tplLenght:function(){var t=this.smsContent,e="【"+t.signature+"】"+t.content;return this.smsTplLength=e.length,e.length}},watch:{"smsContent.signature":function(t,e){var n=this;n.$nextTick(function(){n.inputWitdh(),n.tplLenght()>500&&(n.smsContent.signature=e)})},"smsContent.content":function(t,e){var n=this,i=t.match(/^【(.+?)】/g);if(i&&1===i.length&&i[0].length<25){var a=t.replace(i[0],"");n.smsContent.signature=i[0].replace("【","").replace("】",""),n.smsContent.content=a}n.$nextTick(function(){n.inputWitdh(),n.tplLenght()>500&&(n.smsContent.content=e)})}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sms-tpl bgw"},[n("div",[n("div",{staticClass:"query p2"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.addTpl()}}},[t._v("新增模板")]),t._v(" "),n("el-dropdown",{attrs:{size:"small"}},[n("el-button-group",[n("el-button",{attrs:{type:"default",size:"small"}},[t._v("批量操作")]),t._v(" "),n("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-more"}})],1),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{nativeOn:{click:function(e){return t.del()}}},[t._v("删除")])],1)],1),t._v(" "),n("el-date-picker",{attrs:{"popper-class":"veesing-date-picker",editable:!1,clearable:!1,size:"small",type:"datetimerange",format:"yyyy/MM/dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions},on:{change:function(e){return t.createTime()}},model:{value:t.datePickerVal,callback:function(e){t.datePickerVal=e},expression:"datePickerVal"}}),t._v(" "),n("search-area",{attrs:{search:t.searchData,defTag:t.defTag},on:{searchFun:t.searchFun}})],1),t._v(" "),n("div",{staticClass:"p2 pt0"},[n("el-table",{attrs:{data:t.lists},on:{"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),n("el-table-column",{attrs:{label:"模板ID",prop:"id",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{label:"模板内容",prop:"tplContent","min-width":"300px","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"提交时间",prop:"createTime","min-width":"170"}}),t._v(" "),n("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("p",{staticClass:"operating"},[n("a",{on:{click:function(n){return t.d(e.row)}}},[t._v("详情")]),t._v(" "),n("a",{on:{click:function(n){return t.sent(e.row)}}},[t._v("发送")]),t._v(" "),n("a",{on:{click:function(n){return t.addTpl(e.row)}}},[t._v("修改")]),t._v(" "),n("a",{on:{click:function(n){return t.del(e.row.id)}}},[t._v("删除")])])]}}])})],1),t._v(" "),n("div",{staticClass:"pagination-container"},[n("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-size":t.listQuery.limit,"page-sizes":t.pageSizes,total:t.total,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)]),t._v(" "),n("transition",{attrs:{name:"dialog-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogTpl,expression:"dialogTpl"}],staticClass:"dialog dialog-min"},[n("div",{staticClass:"dialog-body"},[n("div",{staticClass:"dialog-header"},[1==t.dialogTplType?n("span",[t._v("新增模板")]):t._e(),t._v(" "),2==t.dialogTplType?n("span",[t._v("编辑模板")]):t._e(),t._v(" "),n("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogTpl=!1}}})]),t._v(" "),n("div",{staticClass:"dialog-content p2"},[n("div",{staticClass:"alert",staticStyle:{"margin-bottom":"20px"}},[n("i",{staticClass:"el-icon-warning color"}),t._v(" "),n("p",[n("b",[t._v("帮助提示")]),n("br"),t._v("\n              短信模板由签名和内容组成，签名通常为企业名称简称或品牌名称；"),n("br"),t._v("\n              短信内容可以包含变量，在使用变量发送时，需用实际内容替换变量；"),n("br"),t._v("\n              短信一条为70个字符，超过70字符为长短信，长短信计费为每条67个字符。\n            ")])]),t._v(" "),n("el-form",{staticStyle:{width:"520px",margin:"0 auto"},attrs:{"label-position":"right","label-width":"100px"}},[t.form.id?n("div",{staticClass:"el-form-item"},[n("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板ID：")]),t._v(" "),n("div",{staticClass:"el-form-item__content info",staticStyle:{"margin-left":"100px"}},[t._v(t._s(t.form.id))])]):t._e(),t._v(" "),n("div",{staticClass:"el-form-item is-required"},[n("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板内容：")]),t._v(" "),n("div",{staticClass:"el-form-item__content",staticStyle:{"margin-left":"100px"}},[n("div",{staticClass:"sms-content p1",staticStyle:{"margin-top":"12px"}},[n("p",[t._v(t._s(t.smsContent.signature||"短信签名，如：中国移动"))]),t._v(" "),n("div",{staticClass:"input"},[n("span",[t._v("【")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.signature,expression:"smsContent.signature",modifiers:{trim:!0}}],attrs:{type:"text",maxlength:"24",placeholder:"短信签名，如：中国移动"},domProps:{value:t.smsContent.signature},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"signature",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),n("span",[t._v("】")])]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.content,expression:"smsContent.content",modifiers:{trim:!0}}],attrs:{rows:"8",placeholder:"短信内容，如：尊敬的张三你好，您本月消费金额为:${变量}元，请注意查收账单！"},domProps:{value:t.smsContent.content},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"content",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),n("div",{staticClass:"t-r",staticStyle:{"margin-top":"10px"}},[n("span",{staticClass:"cp color",on:{click:function(e){return t.addVar()}}},[n("img",{staticStyle:{"vertical-align":"middle","margin-top":"-3px"},attrs:{src:"/static/client/img/sms/7.png"}}),t._v(" 添加变量")])])]),t._v(" "),n("div",{staticClass:"t-r info"},[t._v("\n                  "+t._s(t.smsTplLength)+"/500 字\n                ")])])])])],1),t._v(" "),n("div",{staticClass:"dialog-footer c p2"},[n("div",{staticClass:"fr"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitTpl()}}},[t._v("确 认")]),t._v(" "),n("el-button",{on:{click:function(e){t.dialogTpl=!1}}},[t._v("取 消")])],1)])])])]),t._v(" "),n("transition",{attrs:{name:"dialog-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogDetail,expression:"dialogDetail"}],staticClass:"dialog list-detail"},[n("div",{staticClass:"dialog-body"},[n("div",{staticClass:"dialog-header"},[t._v("\n          详情 "),n("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogDetail=!1}}})]),t._v(" "),n("div",{staticClass:"dialog-content c p2"},[n("div",{staticClass:"c"},[n("div",[n("span",[t._v("模板ID：")]),t._v(" "),n("span",[t._v(t._s(t.item.id))])]),t._v(" "),n("div",[n("span",[t._v("模板内容：")]),t._v(" "),n("span",[t._v(t._s(t.item.tplContent))])]),t._v(" "),n("div",[n("span",[t._v("提交时间：")]),t._v(" "),n("span",[t._v(t._s(t.item.createTime))])])])])])])])],1)},staticRenderFns:[]},o=n("VU/8")(s,l,!1,null,null,null);e.default=o.exports}});