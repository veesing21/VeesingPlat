webpackJsonp([27],{"5Imi":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("vLgD"),n=i("7biW"),a=i("RAp7"),l=i("X2Oc"),o={inject:["reload"],mixins:[a.a],name:"tpl",components:{"search-area":n.a},data:function(){return{defTag:"id,tplContent",typeLists:"",total:0,lists:[],pageSizes:[10,30,50,100],listQuery:{page:1,limit:10,offset:0,starttime:"",endtime:"",pdType:1},dialogTpl:!1,dialogTplType:1,form:{id:"",tplContent:"",tplType:"",pdType:1},smsContent:{signature:"",content:""},dialogDetail:!1,item:"",smsTplLength:0}},created:function(){var t=this;Object(s.a)("trigmsg/template/listTypes").then(function(e){t.typeLists=e;for(var i=[],s=0;s<e.length;s++){var n={};n.name=e[s].name,n.value=e[s].id,i.push(n)}t.searchData[2].value=i,t.$nextTick(function(){t.searchShow=!0})}).catch(function(t){console.log(t)}),t.getList()},methods:{d:function(t){this.item=t,this.dialogDetail=!0},submitTpl:function(){var t=this,e=t.smsContent;if(e.signature)if(e.content){t.form.tplContent="【"+e.signature+"】"+e.content;var i=2===t.dialogTplType?"trigmsg/template/update":"trigmsg/template/save";Object(s.b)(i,t.form).then(function(e){t.reload()}).catch(function(){})}else t.R("短信内容不能为空！");else t.R("签名不能为空！")},del:function(t){var e=this,i={};if(t)i.ids=[t];else{var n=e.multipleSelection.map(function(t){return t.id});if(n.length<1)return void e.R("请选择要删除的数据!");i.ids=n}e.$confirm("您确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.b)("trigmsg/template/batchRemove",i).then(function(t){e.getList()}).catch(function(){})}).catch(function(){})},addTpl:function(t){var e=this;t?(e.form.id=t.id,e.form.tplType=t.tplType,e.smsContent.content=t.tplContent,e.dialogTplType=2):(e.form.id="",e.form.tplType="",e.smsContent.signature="",e.smsContent.content="",e.form.tplContent="",e.dialogTplType=1),e.dialogTpl=!0},addVar:function(){this.smsContent.content=this.smsContent.content+"【变量】"},getList:function(t){var e=this;t&&(e.listQuery.page=1,e.listQuery.offset=0),e.listQuery.offset=(e.listQuery.page-1)*e.listQuery.limit,Object(s.a)("trigmsg/template/list",e.listQuery).then(function(t){e.lists=t.rows,e.total=t.total}).catch(function(){})},inputWitdh:function(){var t=$(".sms-content p").width();$(".sms-content input").width(t+2);var e=t+40;e=e>68?e:68,$(".sms-content textarea").css({"text-indent":e})},tplLenght:function(){var t=this.smsContent,e="【"+t.signature+"】"+t.content;return this.smsTplLength=e.length,e.length},resetQuery:function(){this.listQuery.id="",this.listQuery.status="",this.listQuery.title="",this.listQuery.content="",this.resetTime(),this.getList()},resetTime:function(){var t=new Date,e=Object(l.e)(t,"yyyy/MM/dd"),i=new Date;i.setTime(i.getTime());var s=Object(l.e)(i,"yyyy/MM/dd")+" 00:00:00",n=e+" 23:59:59";this.listQuery.starttime=s,this.listQuery.endtime=n,this.datePickerVal=[new Date(s),new Date(n)]}},watch:{"smsContent.signature":function(t,e){var i=this;i.$nextTick(function(){i.inputWitdh(),i.tplLenght()>200&&(i.smsContent.signature=e)})},"smsContent.content":function(t,e){var i=this;i.$nextTick(function(){i.inputWitdh(),i.tplLenght()>200&&(i.smsContent.content=e)})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sms-tpl bgw"},[i("div",[i("div",{staticClass:"query p2"},[i("el-form",{attrs:{inline:!0,model:t.listQuery,size:"mini"}},[i("el-form-item",{attrs:{label:"模版ID"}},[i("el-input",{attrs:{placeholder:"模版ID"},model:{value:t.listQuery.id,callback:function(e){t.$set(t.listQuery,"id",e)},expression:"listQuery.id"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"审核状态"}},[i("el-select",{attrs:{placeholder:"审核状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[i("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),i("el-option",{attrs:{label:"驳回",value:"0"}}),t._v(" "),i("el-option",{attrs:{label:"通过",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"等待",value:"2"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"模版内容"}},[i("el-input",{attrs:{placeholder:"模版内容"},model:{value:t.listQuery.content,callback:function(e){t.$set(t.listQuery,"content",e)},expression:"listQuery.content"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"提交时间"}},[i("el-date-picker",{attrs:{"popper-class":"veesing-date-picker",editable:!1,clearable:!1,type:"datetimerange",format:"yyyy/MM/dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions},on:{change:function(e){return t.createTime()}},model:{value:t.datePickerVal,callback:function(e){t.datePickerVal=e},expression:"datePickerVal"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.getList}},[t._v("查询")]),t._v(" "),i("el-button",{on:{click:t.resetQuery}},[t._v("重置")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addTpl()}}},[t._v("新增模板")])],1)],1)],1),t._v(" "),i("div",{staticClass:"p2"},[i("el-table",{attrs:{data:t.lists},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{label:"模板ID",prop:"id","min-width":"100",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"模板内容",prop:"tplContent","min-width":"300px","show-overflow-tooltip":!0}}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间","min-width":"170px",prop:"createTime",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"更新时间","min-width":"170px",prop:"modifyTime",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"状态","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.tplStatus?i("p",{staticClass:"td-btn"},[i("font",{staticClass:"point point-error"},[t._v("驳回")])],1):t._e(),t._v(" "),2===e.row.tplStatus?i("p",{staticClass:"td-btn"},[i("font",{staticClass:"point point-warning"},[t._v("通过")])],1):t._e(),t._v(" "),1===e.row.tplStatus?i("p",{staticClass:"td-btn"},[i("font",{staticClass:"point point-success"},[t._v("等待")])],1):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("p",{staticClass:"operating"},[i("a",{on:{click:function(i){return t.d(e.row)}}},[t._v("详情")]),t._v(" "),i("a",{on:{click:function(i){return t.addTpl(e.row)}}},[t._v("修改")]),t._v(" "),i("a",{on:{click:function(i){return t.del(e.row.id)}}},[t._v("删除")])])]}}])})],1),t._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-size":t.listQuery.limit,"page-sizes":t.pageSizes,total:t.total,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1)]),t._v(" "),i("transition",{attrs:{name:"dialog-fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogTpl,expression:"dialogTpl"}],staticClass:"dialog dialog-min"},[i("div",{staticClass:"dialog-body"},[i("div",{staticClass:"dialog-header"},[1==t.dialogTplType?i("span",[t._v("新增模板")]):t._e(),t._v(" "),2==t.dialogTplType?i("span",[t._v("编辑模板")]):t._e(),t._v(" "),i("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogTpl=!1}}})]),t._v(" "),i("div",{staticClass:"dialog-content p2"},[i("div",{staticClass:"alert",staticStyle:{"margin-bottom":"20px"}},[i("i",{staticClass:"el-icon-warning color"}),t._v(" "),i("p",[i("b",[t._v("帮助提示")]),i("br"),t._v("\n              短信模板由签名和内容组成，签名通常为企业名称简称或品牌名称；"),i("br"),t._v("\n              短信内容需要包含变量，但内容主体部分需能够体现短信意图；"),i("br"),t._v("\n              短信一条为70个字符，超过70字符为长短信，长短信计费为每条67个字符。\n            ")])]),t._v(" "),i("el-form",{staticStyle:{width:"520px",margin:"0 auto"},attrs:{"label-position":"right","label-width":"100px"}},[t.form.id?i("div",{staticClass:"el-form-item"},[i("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板ID：")]),t._v(" "),i("div",{staticClass:"el-form-item__content info",staticStyle:{"margin-left":"100px"}},[t._v("\n                "+t._s(t.form.id)+"\n              ")])]):t._e(),t._v(" "),i("el-form-item",{staticClass:"is-required",attrs:{label:"模版类型:"}},[i("el-select",{staticClass:"w100",attrs:{placeholder:"请选择模版类型"},model:{value:t.form.tplType,callback:function(e){t.$set(t.form,"tplType",e)},expression:"form.tplType"}},t._l(t.typeLists,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),i("div",{staticClass:"el-form-item is-required"},[i("label",{staticClass:"el-form-item__label",staticStyle:{width:"100px"}},[t._v("模板内容：")]),t._v(" "),i("div",{staticClass:"el-form-item__content",staticStyle:{"margin-left":"100px"}},[i("div",{staticClass:"sms-content p1",staticStyle:{"margin-top":"12px"}},[i("p",[t._v("\n                    "+t._s(t.smsContent.signature||"短信签名，如：中国移动")+"\n                  ")]),t._v(" "),i("div",{staticClass:"input"},[i("span",[t._v("【")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.signature,expression:"smsContent.signature",modifiers:{trim:!0}}],attrs:{type:"text",maxlength:"24",placeholder:"短信签名，如：中国移动"},domProps:{value:t.smsContent.signature},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"signature",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),i("span",[t._v("】")])]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.smsContent.content,expression:"smsContent.content",modifiers:{trim:!0}}],attrs:{rows:"8",placeholder:"短信内容，如：尊敬的张三你好，您本月消费金额为:【变量】元，请注意查收账单！"},domProps:{value:t.smsContent.content},on:{input:function(e){e.target.composing||t.$set(t.smsContent,"content",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),i("div",{staticClass:"t-r",staticStyle:{"margin-top":"10px"}},[i("span",{staticClass:"cp color",on:{click:function(e){return t.addVar()}}},[i("img",{staticStyle:{"vertical-align":"middle","margin-top":"-3px"},attrs:{src:"/static/client/img/sms/7.png"}}),t._v("\n                      添加变量")])])]),t._v(" "),i("div",{staticClass:"t-r info"},[t._v(t._s(t.smsTplLength)+"/200 字")])])])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer c p2"},[i("div",{staticClass:"fr"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitTpl()}}},[t._v("确 认")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogTpl=!1}}},[t._v("取 消")])],1)])])])]),t._v(" "),i("transition",{attrs:{name:"dialog-fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogDetail,expression:"dialogDetail"}],staticClass:"dialog list-detail"},[i("div",{staticClass:"dialog-body"},[i("div",{staticClass:"dialog-header"},[t._v("\n          详情\n          "),i("i",{staticClass:"fr iconfont iconsystem-cancel-bold",on:{click:function(e){t.dialogDetail=!1}}})]),t._v(" "),i("div",{staticClass:"dialog-content c p2"},[i("div",{staticClass:"c"},[i("div",[i("span",[t._v("模板ID：")]),t._v(" "),i("span",[t._v(t._s(t.item.id))])]),t._v(" "),i("div",[i("span",[t._v("模板内容：")]),t._v(" "),i("span",[t._v(t._s(t.item.tplContent))])]),t._v(" "),i("div",[i("span",[t._v("模板类型：")]),t._v(" "),i("span",[t._v(t._s(t.item.tplTypeName))])])]),t._v(" "),i("div",{staticClass:"c"},[i("div",[i("span",[t._v("状态：")]),t._v(" "),0==t.item.tplStatus?i("span",{staticClass:"error"},[t._v("未通过")]):t._e(),t._v(" "),1==t.item.tplStatus?i("span",{staticClass:"success"},[t._v("已通过")]):t._e(),t._v(" "),2==t.item.tplStatus?i("span",{staticClass:"warning"},[t._v("未审核")]):t._e()]),t._v(" "),i("div",[i("span",[t._v("更新时间：")]),t._v(" "),t.item.modifyTime?i("span",[t._v(t._s(t.item.modifyTime))]):i("span",[t._v(t._s(t.item.createTime))])])])])])])])],1)},staticRenderFns:[]},c=i("VU/8")(o,r,!1,null,null,null);e.default=c.exports}});